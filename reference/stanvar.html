<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>User-defined variables passed to Stan — stanvar • brms</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="User-defined variables passed to Stan — stanvar" />
<meta property="og:description" content="Prepare user-defined variables to be passed to one of Stan's 
program blocks. This is primarily useful for defining more complex 
priors, for refitting models without recompilation despite 
changing priors, or for defining custom Stan functions." />
<meta property="og:image" content="/logo.png" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">brms</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.14.11</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Other Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="http://mc-stan.org/rstan">rstan</a>
    </li>
    <li>
      <a href="http://mc-stan.org/rstanarm">rstanarm</a>
    </li>
    <li>
      <a href="http://mc-stan.org/bayesplot">bayesplot</a>
    </li>
    <li>
      <a href="http://mc-stan.org/shinystan">shinystan</a>
    </li>
    <li>
      <a href="http://mc-stan.org/loo">loo</a>
    </li>
    <li>
      <a href="http://mc-stan.org/projpred">projpred</a>
    </li>
    <li>
      <a href="http://mc-stan.org/rstantools">rstantools</a>
    </li>
  </ul>
</li>
<li>
  <a href="http://mc-stan.org">Stan</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://twitter.com/mcmc_stan">
    <span class="fas fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/stan-dev/brms">
    <span class="fas fa-github"></span>
     
  </a>
</li>
<li>
  <a href="http://discourse.mc-stan.org/">
    <span class="fas fa-users"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>User-defined variables passed to Stan</h1>
    <small class="dont-index">Source: <a href='https://github.com/paul-buerkner/brms/blob/master/R/stanvars.R'><code>R/stanvars.R</code></a></small>
    <div class="hidden name"><code>stanvar.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Prepare user-defined variables to be passed to one of Stan's 
program blocks. This is primarily useful for defining more complex 
priors, for refitting models without recompilation despite 
changing priors, or for defining custom Stan functions.</p>
    </div>

    <pre class="usage"><span class='fu'>stanvar</span><span class='op'>(</span>
  x <span class='op'>=</span> <span class='cn'>NULL</span>,
  name <span class='op'>=</span> <span class='cn'>NULL</span>,
  scode <span class='op'>=</span> <span class='cn'>NULL</span>,
  block <span class='op'>=</span> <span class='st'>"data"</span>,
  position <span class='op'>=</span> <span class='st'>"start"</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>An <span style="R">R</span> object containing data to be passed to Stan.
Only required if <code>block = 'data'</code> and ignored otherwise.</p></td>
    </tr>
    <tr>
      <th>name</th>
      <td><p>Optional character string providing the desired variable 
name of the object in <code>x</code>. If <code>NULL</code> (the default)
the variable name is directly inferred from <code>x</code>.</p></td>
    </tr>
    <tr>
      <th>scode</th>
      <td><p>Line of Stan code to define the variable
in Stan language. If <code>block = 'data'</code>, the
Stan code is inferred based on the class of <code>x</code> by default.</p></td>
    </tr>
    <tr>
      <th>block</th>
      <td><p>Name of one of Stan's program blocks in
which the variable should be defined. Can be <code>'data'</code>,
<code>'tdata'</code> (transformed data), <code>'parameters'</code>,
<code>'tparameters'</code> (transformed parameters), <code>'model'</code>,
<code>'genquant'</code> (generated quantities) or <code>'functions'</code>.</p></td>
    </tr>
    <tr>
      <th>position</th>
      <td><p>Name of the position within the block where the
Stan code should be placed. Currently allowed are <code>'start'</code>
(the default) and <code>'end'</code> of the block.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An object of class <code>stanvars</code>.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='va'>bprior</span> <span class='op'>&lt;-</span> <span class='fu'><a href='set_prior.html'>prior</a></span><span class='op'>(</span><span class='fu'>normal</span><span class='op'>(</span><span class='va'>mean_intercept</span>, <span class='fl'>10</span><span class='op'>)</span>, class <span class='op'>=</span> <span class='st'>"Intercept"</span><span class='op'>)</span>
<span class='va'>stanvars</span> <span class='op'>&lt;-</span> <span class='fu'>stanvar</span><span class='op'>(</span><span class='fl'>5</span>, name <span class='op'>=</span> <span class='st'>"mean_intercept"</span><span class='op'>)</span>
<span class='fu'><a href='make_stancode.html'>make_stancode</a></span><span class='op'>(</span><span class='va'>count</span> <span class='op'>~</span> <span class='va'>Trt</span>, <span class='va'>epilepsy</span>, prior <span class='op'>=</span> <span class='va'>bprior</span>, 
              stanvars <span class='op'>=</span> <span class='va'>stanvars</span><span class='op'>)</span>
</div><div class='output co'>#&gt; // generated with brms 2.14.11
#&gt; functions {
#&gt; }
#&gt; data {
#&gt;   int&lt;lower=1&gt; N;  // total number of observations
#&gt;   vector[N] Y;  // response variable
#&gt;   int&lt;lower=1&gt; K;  // number of population-level effects
#&gt;   matrix[N, K] X;  // population-level design matrix
#&gt;   int prior_only;  // should the likelihood be ignored?
#&gt;   real mean_intercept;
#&gt; }
#&gt; transformed data {
#&gt;   int Kc = K - 1;
#&gt;   matrix[N, Kc] Xc;  // centered version of X without an intercept
#&gt;   vector[Kc] means_X;  // column means of X before centering
#&gt;   for (i in 2:K) {
#&gt;     means_X[i - 1] = mean(X[, i]);
#&gt;     Xc[, i - 1] = X[, i] - means_X[i - 1];
#&gt;   }
#&gt; }
#&gt; parameters {
#&gt;   vector[Kc] b;  // population-level effects
#&gt;   real Intercept;  // temporary intercept for centered predictors
#&gt;   real&lt;lower=0&gt; sigma;  // residual SD
#&gt; }
#&gt; transformed parameters {
#&gt; }
#&gt; model {
#&gt;   // likelihood including constants
#&gt;   if (!prior_only) {
#&gt;     target += normal_id_glm_lpdf(Y | Xc, Intercept, b, sigma);
#&gt;   }
#&gt;   // priors including constants
#&gt;   target += normal_lpdf(Intercept | mean_intercept, 10);
#&gt;   target += student_t_lpdf(sigma | 3, 0, 4.4)
#&gt;     - 1 * student_t_lccdf(0 | 3, 0, 4.4);
#&gt; }
#&gt; generated quantities {
#&gt;   // actual population-level intercept
#&gt;   real b_Intercept = Intercept - dot_product(means_X, b);
#&gt; }</div><div class='input'>              
<span class='co'># define a multi-normal prior with known covariance matrix</span>
<span class='va'>bprior</span> <span class='op'>&lt;-</span> <span class='fu'><a href='set_prior.html'>prior</a></span><span class='op'>(</span><span class='fu'>multi_normal</span><span class='op'>(</span><span class='va'>M</span>, <span class='va'>V</span><span class='op'>)</span>, class <span class='op'>=</span> <span class='st'>"b"</span><span class='op'>)</span>
<span class='va'>stanvars</span> <span class='op'>&lt;-</span> <span class='fu'>stanvar</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>2</span><span class='op'>)</span>, <span class='st'>"M"</span>, scode <span class='op'>=</span> <span class='st'>"  vector[K] M;"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>stanvar</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/diag.html'>diag</a></span><span class='op'>(</span><span class='fl'>2</span><span class='op'>)</span>, <span class='st'>"V"</span>, scode <span class='op'>=</span> <span class='st'>"  matrix[K, K] V;"</span><span class='op'>)</span> 
<span class='fu'><a href='make_stancode.html'>make_stancode</a></span><span class='op'>(</span><span class='va'>count</span> <span class='op'>~</span> <span class='va'>Trt</span> <span class='op'>+</span> <span class='va'>zBase</span>, <span class='va'>epilepsy</span>,
              prior <span class='op'>=</span> <span class='va'>bprior</span>, stanvars <span class='op'>=</span> <span class='va'>stanvars</span><span class='op'>)</span>
</div><div class='output co'>#&gt; // generated with brms 2.14.11
#&gt; functions {
#&gt; }
#&gt; data {
#&gt;   int&lt;lower=1&gt; N;  // total number of observations
#&gt;   vector[N] Y;  // response variable
#&gt;   int&lt;lower=1&gt; K;  // number of population-level effects
#&gt;   matrix[N, K] X;  // population-level design matrix
#&gt;   int prior_only;  // should the likelihood be ignored?
#&gt;   vector[K] M;
#&gt;   matrix[K, K] V;
#&gt; }
#&gt; transformed data {
#&gt;   int Kc = K - 1;
#&gt;   matrix[N, Kc] Xc;  // centered version of X without an intercept
#&gt;   vector[Kc] means_X;  // column means of X before centering
#&gt;   for (i in 2:K) {
#&gt;     means_X[i - 1] = mean(X[, i]);
#&gt;     Xc[, i - 1] = X[, i] - means_X[i - 1];
#&gt;   }
#&gt; }
#&gt; parameters {
#&gt;   vector[Kc] b;  // population-level effects
#&gt;   real Intercept;  // temporary intercept for centered predictors
#&gt;   real&lt;lower=0&gt; sigma;  // residual SD
#&gt; }
#&gt; transformed parameters {
#&gt; }
#&gt; model {
#&gt;   // likelihood including constants
#&gt;   if (!prior_only) {
#&gt;     target += normal_id_glm_lpdf(Y | Xc, Intercept, b, sigma);
#&gt;   }
#&gt;   // priors including constants
#&gt;   target += multi_normal_lpdf(b | M, V);
#&gt;   target += student_t_lpdf(Intercept | 3, 4, 4.4);
#&gt;   target += student_t_lpdf(sigma | 3, 0, 4.4)
#&gt;     - 1 * student_t_lccdf(0 | 3, 0, 4.4);
#&gt; }
#&gt; generated quantities {
#&gt;   // actual population-level intercept
#&gt;   real b_Intercept = Intercept - dot_product(means_X, b);
#&gt; }</div><div class='input'>              
<span class='co'># define a hierachical prior on the regression coefficients</span>
<span class='va'>bprior</span> <span class='op'>&lt;-</span> <span class='fu'><a href='set_prior.html'>set_prior</a></span><span class='op'>(</span><span class='st'>"normal(0, tau)"</span>, class <span class='op'>=</span> <span class='st'>"b"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='set_prior.html'>set_prior</a></span><span class='op'>(</span><span class='st'>"target += normal_lpdf(tau | 0, 10)"</span>, check <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
<span class='va'>stanvars</span> <span class='op'>&lt;-</span> <span class='fu'>stanvar</span><span class='op'>(</span>scode <span class='op'>=</span> <span class='st'>"real&lt;lower=0&gt; tau;"</span>, 
                    block <span class='op'>=</span> <span class='st'>"parameters"</span><span class='op'>)</span>
<span class='fu'><a href='make_stancode.html'>make_stancode</a></span><span class='op'>(</span><span class='va'>count</span> <span class='op'>~</span> <span class='va'>Trt</span> <span class='op'>+</span> <span class='va'>zBase</span>, <span class='va'>epilepsy</span>,
              prior <span class='op'>=</span> <span class='va'>bprior</span>, stanvars <span class='op'>=</span> <span class='va'>stanvars</span><span class='op'>)</span>
</div><div class='output co'>#&gt; // generated with brms 2.14.11
#&gt; functions {
#&gt; }
#&gt; data {
#&gt;   int&lt;lower=1&gt; N;  // total number of observations
#&gt;   vector[N] Y;  // response variable
#&gt;   int&lt;lower=1&gt; K;  // number of population-level effects
#&gt;   matrix[N, K] X;  // population-level design matrix
#&gt;   int prior_only;  // should the likelihood be ignored?
#&gt; }
#&gt; transformed data {
#&gt;   int Kc = K - 1;
#&gt;   matrix[N, Kc] Xc;  // centered version of X without an intercept
#&gt;   vector[Kc] means_X;  // column means of X before centering
#&gt;   for (i in 2:K) {
#&gt;     means_X[i - 1] = mean(X[, i]);
#&gt;     Xc[, i - 1] = X[, i] - means_X[i - 1];
#&gt;   }
#&gt; }
#&gt; parameters {
#&gt;   vector[Kc] b;  // population-level effects
#&gt;   real Intercept;  // temporary intercept for centered predictors
#&gt;   real&lt;lower=0&gt; sigma;  // residual SD
#&gt; real&lt;lower=0&gt; tau;
#&gt; }
#&gt; transformed parameters {
#&gt; }
#&gt; model {
#&gt;   // likelihood including constants
#&gt;   if (!prior_only) {
#&gt;     target += normal_id_glm_lpdf(Y | Xc, Intercept, b, sigma);
#&gt;   }
#&gt;   // priors including constants
#&gt;   target += normal_lpdf(b | 0, tau);
#&gt;   target += student_t_lpdf(Intercept | 3, 4, 4.4);
#&gt;   target += student_t_lpdf(sigma | 3, 0, 4.4)
#&gt;     - 1 * student_t_lccdf(0 | 3, 0, 4.4);
#&gt;   target += normal_lpdf(tau | 0, 10);
#&gt; }
#&gt; generated quantities {
#&gt;   // actual population-level intercept
#&gt;   real b_Intercept = Intercept - dot_product(means_X, b);
#&gt; }</div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Paul-Christian Bürkner.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


