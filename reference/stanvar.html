<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>User-defined variables passed to Stan — stanvar • brms</title>

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="User-defined variables passed to Stan — stanvar" />

<meta property="og:description" content="Prepare user-defined variables to be passed to one of Stan's 
program blocks. This is primarily useful for defining more complex 
priors, for refitting models without recompilation despite 
changing priors, or for defining custom Stan functions." />

<meta property="og:image" content="/logo.png" />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">brms</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.10.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Other Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="http://mc-stan.org/rstan">rstan</a>
    </li>
    <li>
      <a href="http://mc-stan.org/rstanarm">rstanarm</a>
    </li>
    <li>
      <a href="http://mc-stan.org/bayesplot">bayesplot</a>
    </li>
    <li>
      <a href="http://mc-stan.org/shinystan">shinystan</a>
    </li>
    <li>
      <a href="http://mc-stan.org/loo">loo</a>
    </li>
    <li>
      <a href="http://mc-stan.org/projpred">projpred</a>
    </li>
    <li>
      <a href="http://mc-stan.org/rstantools">rstantools</a>
    </li>
  </ul>
</li>
<li>
  <a href="http://mc-stan.org">Stan</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://twitter.com/mcmc_stan">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/stan-dev/brms">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="http://discourse.mc-stan.org/">
    <span class="fa fa-users"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>User-defined variables passed to Stan</h1>
    <small class="dont-index">Source: <a href='https://github.com/paul-buerkner/brms/blob/master/R/stanvars.R'><code>R/stanvars.R</code></a></small>
    <div class="hidden name"><code>stanvar.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>Prepare user-defined variables to be passed to one of Stan's 
program blocks. This is primarily useful for defining more complex 
priors, for refitting models without recompilation despite 
changing priors, or for defining custom Stan functions.</p>
    
    </div>

    <pre class="usage"><span class='fu'>stanvar</span>(<span class='kw'>x</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>name</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>scode</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>block</span> <span class='kw'>=</span> <span class='st'>"data"</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>An <span style="R">R</span> object containing data to be passed to Stan.
Only required if <code>block = 'data'</code> and ignored otherwise.</p></td>
    </tr>
    <tr>
      <th>name</th>
      <td><p>Optinal character string providing the desired variable 
name of the object in <code>x</code>. If <code>NULL</code> (the default)
the variable name is directly infered from <code>x</code>.</p></td>
    </tr>
    <tr>
      <th>scode</th>
      <td><p>Line of Stan code to define the variable
in Stan language. If <code>block = 'data'</code>, the
Stan code is inferred based on the class of <code>x</code> by default.</p></td>
    </tr>
    <tr>
      <th>block</th>
      <td><p>Name of one of Stan's program blocks in
which the variable should be defined. Can be <code>'data'</code>,
<code>'tdata'</code> (transformed data), <code>'parameters'</code>,
<code>'tparameters'</code> (transformed parameters), <code>'model'</code>,
<code>'genquant'</code> (generated quantities) or <code>'functions'</code>.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An object of class <code>stanvars</code>.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='no'>bprior</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='set_prior.html'>prior</a></span>(<span class='fu'>normal</span>(<span class='no'>mean_intercept</span>, <span class='fl'>10</span>), <span class='kw'>class</span> <span class='kw'>=</span> <span class='st'>"Intercept"</span>)
<span class='no'>stanvars</span> <span class='kw'>&lt;-</span> <span class='fu'>stanvar</span>(<span class='fl'>5</span>, <span class='kw'>name</span> <span class='kw'>=</span> <span class='st'>"mean_intercept"</span>)
<span class='fu'><a href='make_stancode.html'>make_stancode</a></span>(<span class='no'>count</span> ~ <span class='no'>Trt</span>, <span class='no'>epilepsy</span>, <span class='kw'>prior</span> <span class='kw'>=</span> <span class='no'>bprior</span>,
              <span class='kw'>stanvars</span> <span class='kw'>=</span> <span class='no'>stanvars</span>)</div><div class='output co'>#&gt; // generated with brms 2.10.3
#&gt; functions {
#&gt; }
#&gt; data {
#&gt;   int&lt;lower=1&gt; N;  // number of observations
#&gt;   vector[N] Y;  // response variable
#&gt;   int&lt;lower=1&gt; K;  // number of population-level effects
#&gt;   matrix[N, K] X;  // population-level design matrix
#&gt;   int prior_only;  // should the likelihood be ignored?
#&gt;   real mean_intercept;
#&gt; }
#&gt; transformed data {
#&gt;   int Kc = K - 1;
#&gt;   matrix[N, Kc] Xc;  // centered version of X without an intercept
#&gt;   vector[Kc] means_X;  // column means of X before centering
#&gt;   for (i in 2:K) {
#&gt;     means_X[i - 1] = mean(X[, i]);
#&gt;     Xc[, i - 1] = X[, i] - means_X[i - 1];
#&gt;   }
#&gt; }
#&gt; parameters {
#&gt;   vector[Kc] b;  // population-level effects
#&gt;   // temporary intercept for centered predictors
#&gt;   real Intercept;
#&gt;   real&lt;lower=0&gt; sigma;  // residual SD
#&gt; }
#&gt; transformed parameters {
#&gt; }
#&gt; model {
#&gt;   // priors including all constants
#&gt;   target += normal_lpdf(Intercept | mean_intercept, 10);
#&gt;   target += student_t_lpdf(sigma | 3, 0, 10)
#&gt;     - 1 * student_t_lccdf(0 | 3, 0, 10);
#&gt;   // likelihood including all constants
#&gt;   if (!prior_only) {
#&gt;     target += normal_id_glm_lpdf(Y | Xc, Intercept, b, sigma);
#&gt;   }
#&gt; }
#&gt; generated quantities {
#&gt;   // actual population-level intercept
#&gt;   real b_Intercept = Intercept - dot_product(means_X, b);
#&gt; }</div><div class='input'>
<span class='co'># define a multi-normal prior with known covariance matrix</span>
<span class='no'>bprior</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='set_prior.html'>prior</a></span>(<span class='fu'>multi_normal</span>(<span class='no'>M</span>, <span class='no'>V</span>), <span class='kw'>class</span> <span class='kw'>=</span> <span class='st'>"b"</span>)
<span class='no'>stanvars</span> <span class='kw'>&lt;-</span> <span class='fu'>stanvar</span>(<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/rep'>rep</a></span>(<span class='fl'>0</span>, <span class='fl'>2</span>), <span class='st'>"M"</span>, <span class='kw'>scode</span> <span class='kw'>=</span> <span class='st'>"  vector[K] M;"</span>) +
  <span class='fu'>stanvar</span>(<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/diag'>diag</a></span>(<span class='fl'>2</span>), <span class='st'>"V"</span>, <span class='kw'>scode</span> <span class='kw'>=</span> <span class='st'>"  matrix[K, K] V;"</span>)
<span class='fu'><a href='make_stancode.html'>make_stancode</a></span>(<span class='no'>count</span> ~ <span class='no'>Trt</span> + <span class='no'>zBase</span>, <span class='no'>epilepsy</span>,
              <span class='kw'>prior</span> <span class='kw'>=</span> <span class='no'>bprior</span>, <span class='kw'>stanvars</span> <span class='kw'>=</span> <span class='no'>stanvars</span>)</div><div class='output co'>#&gt; // generated with brms 2.10.3
#&gt; functions {
#&gt; }
#&gt; data {
#&gt;   int&lt;lower=1&gt; N;  // number of observations
#&gt;   vector[N] Y;  // response variable
#&gt;   int&lt;lower=1&gt; K;  // number of population-level effects
#&gt;   matrix[N, K] X;  // population-level design matrix
#&gt;   int prior_only;  // should the likelihood be ignored?
#&gt;   vector[K] M;
#&gt;   matrix[K, K] V;
#&gt; }
#&gt; transformed data {
#&gt;   int Kc = K - 1;
#&gt;   matrix[N, Kc] Xc;  // centered version of X without an intercept
#&gt;   vector[Kc] means_X;  // column means of X before centering
#&gt;   for (i in 2:K) {
#&gt;     means_X[i - 1] = mean(X[, i]);
#&gt;     Xc[, i - 1] = X[, i] - means_X[i - 1];
#&gt;   }
#&gt; }
#&gt; parameters {
#&gt;   vector[Kc] b;  // population-level effects
#&gt;   // temporary intercept for centered predictors
#&gt;   real Intercept;
#&gt;   real&lt;lower=0&gt; sigma;  // residual SD
#&gt; }
#&gt; transformed parameters {
#&gt; }
#&gt; model {
#&gt;   // priors including all constants
#&gt;   target += multi_normal_lpdf(b | M, V);
#&gt;   target += student_t_lpdf(Intercept | 3, 4, 10);
#&gt;   target += student_t_lpdf(sigma | 3, 0, 10)
#&gt;     - 1 * student_t_lccdf(0 | 3, 0, 10);
#&gt;   // likelihood including all constants
#&gt;   if (!prior_only) {
#&gt;     target += normal_id_glm_lpdf(Y | Xc, Intercept, b, sigma);
#&gt;   }
#&gt; }
#&gt; generated quantities {
#&gt;   // actual population-level intercept
#&gt;   real b_Intercept = Intercept - dot_product(means_X, b);
#&gt; }</div><div class='input'>
<span class='co'># define a hierachical prior on the regression coefficients</span>
<span class='no'>bprior</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='set_prior.html'>set_prior</a></span>(<span class='st'>"normal(0, tau)"</span>, <span class='kw'>class</span> <span class='kw'>=</span> <span class='st'>"b"</span>) +
  <span class='fu'><a href='set_prior.html'>set_prior</a></span>(<span class='st'>"target += normal_lpdf(tau | 0, 10)"</span>, <span class='kw'>check</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)
<span class='no'>stanvars</span> <span class='kw'>&lt;-</span> <span class='fu'>stanvar</span>(<span class='kw'>scode</span> <span class='kw'>=</span> <span class='st'>"real&lt;lower=0&gt; tau;"</span>,
                    <span class='kw'>block</span> <span class='kw'>=</span> <span class='st'>"parameters"</span>)
<span class='fu'><a href='make_stancode.html'>make_stancode</a></span>(<span class='no'>count</span> ~ <span class='no'>Trt</span> + <span class='no'>zBase</span>, <span class='no'>epilepsy</span>,
              <span class='kw'>prior</span> <span class='kw'>=</span> <span class='no'>bprior</span>, <span class='kw'>stanvars</span> <span class='kw'>=</span> <span class='no'>stanvars</span>)</div><div class='output co'>#&gt; // generated with brms 2.10.3
#&gt; functions {
#&gt; }
#&gt; data {
#&gt;   int&lt;lower=1&gt; N;  // number of observations
#&gt;   vector[N] Y;  // response variable
#&gt;   int&lt;lower=1&gt; K;  // number of population-level effects
#&gt;   matrix[N, K] X;  // population-level design matrix
#&gt;   int prior_only;  // should the likelihood be ignored?
#&gt; }
#&gt; transformed data {
#&gt;   int Kc = K - 1;
#&gt;   matrix[N, Kc] Xc;  // centered version of X without an intercept
#&gt;   vector[Kc] means_X;  // column means of X before centering
#&gt;   for (i in 2:K) {
#&gt;     means_X[i - 1] = mean(X[, i]);
#&gt;     Xc[, i - 1] = X[, i] - means_X[i - 1];
#&gt;   }
#&gt; }
#&gt; parameters {
#&gt;   vector[Kc] b;  // population-level effects
#&gt;   // temporary intercept for centered predictors
#&gt;   real Intercept;
#&gt;   real&lt;lower=0&gt; sigma;  // residual SD
#&gt; real&lt;lower=0&gt; tau;
#&gt; }
#&gt; transformed parameters {
#&gt; }
#&gt; model {
#&gt;   // priors including all constants
#&gt;   target += normal_lpdf(b | 0, tau);
#&gt;   target += student_t_lpdf(Intercept | 3, 4, 10);
#&gt;   target += student_t_lpdf(sigma | 3, 0, 10)
#&gt;     - 1 * student_t_lccdf(0 | 3, 0, 10);
#&gt;   target += normal_lpdf(tau | 0, 10);
#&gt;   // likelihood including all constants
#&gt;   if (!prior_only) {
#&gt;     target += normal_id_glm_lpdf(Y | Xc, Intercept, b, sigma);
#&gt;   }
#&gt; }
#&gt; generated quantities {
#&gt;   // actual population-level intercept
#&gt;   real b_Intercept = Intercept - dot_product(means_X, b);
#&gt; }</div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Paul-Christian Bürkner.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
   </div>

  

  </body>
</html>

