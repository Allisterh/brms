<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Run the same brms model on multiple datasets — brm_multiple • brms</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Run the same brms model on multiple datasets — brm_multiple" />
<meta property="og:description" content="Run the same brms model on multiple datasets and then combine the
results into one fitted model object. This is useful in particular for
multiple missing value imputation, where the same model is fitted on multiple
imputed data sets. Models can be run in parallel using the future
package." />
<meta property="og:image" content="/logo.png" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">brms</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.14.11</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Other Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="http://mc-stan.org/rstan">rstan</a>
    </li>
    <li>
      <a href="http://mc-stan.org/rstanarm">rstanarm</a>
    </li>
    <li>
      <a href="http://mc-stan.org/bayesplot">bayesplot</a>
    </li>
    <li>
      <a href="http://mc-stan.org/shinystan">shinystan</a>
    </li>
    <li>
      <a href="http://mc-stan.org/loo">loo</a>
    </li>
    <li>
      <a href="http://mc-stan.org/projpred">projpred</a>
    </li>
    <li>
      <a href="http://mc-stan.org/rstantools">rstantools</a>
    </li>
  </ul>
</li>
<li>
  <a href="http://mc-stan.org">Stan</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://twitter.com/mcmc_stan">
    <span class="fas fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/stan-dev/brms">
    <span class="fas fa-github"></span>
     
  </a>
</li>
<li>
  <a href="http://discourse.mc-stan.org/">
    <span class="fas fa-users"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Run the same <span class="pkg">brms</span> model on multiple datasets</h1>
    <small class="dont-index">Source: <a href='https://github.com/paul-buerkner/brms/blob/master/R/brm_multiple.R'><code>R/brm_multiple.R</code></a></small>
    <div class="hidden name"><code>brm_multiple.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Run the same <span class="pkg">brms</span> model on multiple datasets and then combine the
results into one fitted model object. This is useful in particular for
multiple missing value imputation, where the same model is fitted on multiple
imputed data sets. Models can be run in parallel using the <span class="pkg">future</span>
package.</p>
    </div>

    <pre class="usage"><span class='fu'>brm_multiple</span><span class='op'>(</span>
  <span class='va'>formula</span>,
  <span class='va'>data</span>,
  family <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/family.html'>gaussian</a></span><span class='op'>(</span><span class='op'>)</span>,
  prior <span class='op'>=</span> <span class='cn'>NULL</span>,
  data2 <span class='op'>=</span> <span class='cn'>NULL</span>,
  autocor <span class='op'>=</span> <span class='cn'>NULL</span>,
  cov_ranef <span class='op'>=</span> <span class='cn'>NULL</span>,
  sample_prior <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"no"</span>, <span class='st'>"yes"</span>, <span class='st'>"only"</span><span class='op'>)</span>,
  sparse <span class='op'>=</span> <span class='cn'>NULL</span>,
  knots <span class='op'>=</span> <span class='cn'>NULL</span>,
  stanvars <span class='op'>=</span> <span class='cn'>NULL</span>,
  stan_funs <span class='op'>=</span> <span class='cn'>NULL</span>,
  recompile <span class='op'>=</span> <span class='cn'>FALSE</span>,
  combine <span class='op'>=</span> <span class='cn'>TRUE</span>,
  fit <span class='op'>=</span> <span class='cn'>NA</span>,
  seed <span class='op'>=</span> <span class='cn'>NA</span>,
  file <span class='op'>=</span> <span class='cn'>NULL</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>formula</th>
      <td><p>An object of class <code><a href='https://rdrr.io/r/stats/formula.html'>formula</a></code>,
<code><a href='brmsformula.html'>brmsformula</a></code>, or <code><a href='mvbrmsformula.html'>mvbrmsformula</a></code> (or one that can
be coerced to that classes): A symbolic description of the model to be
fitted. The details of model specification are explained in
<code><a href='brmsformula.html'>brmsformula</a></code>.</p></td>
    </tr>
    <tr>
      <th>data</th>
      <td><p>A <em>list</em> of data.frames each of which will be used to fit a
separate model. Alternatively, a <code>mids</code> object from the <span class="pkg">mice</span>
package.</p></td>
    </tr>
    <tr>
      <th>family</th>
      <td><p>A description of the response distribution and link function to
be used in the model. This can be a family function, a call to a family
function or a character string naming the family. Every family function has
a <code>link</code> argument allowing to specify the link function to be applied
on the response variable. If not specified, default links are used. For
details of supported families see <code><a href='brmsfamily.html'>brmsfamily</a></code>. By default, a
linear <code>gaussian</code> model is applied. In multivariate models,
<code>family</code> might also be a list of families.</p></td>
    </tr>
    <tr>
      <th>prior</th>
      <td><p>One or more <code>brmsprior</code> objects created by
<code><a href='set_prior.html'>set_prior</a></code> or related functions and combined using the
<code>c</code> method or the <code><a href='https://rdrr.io/r/base/Arithmetic.html'>+</a></code> operator. See also  <code><a href='get_prior.html'>get_prior</a></code>
for more help.</p></td>
    </tr>
    <tr>
      <th>data2</th>
      <td><p>A <em>list</em> of named lists each of which will be used to fit a
separate model. Each of the named lists contains objects representing data
which cannot be passed via argument <code>data</code> (see <code><a href='brm.html'>brm</a></code> for
examples). The length of the outer list should match the length of the list
passed to the <code>data</code> argument.</p></td>
    </tr>
    <tr>
      <th>autocor</th>
      <td><p>(Deprecated) An optional <code><a href='cor_brms.html'>cor_brms</a></code> object
describing the correlation structure within the response variable (i.e.,
the 'autocorrelation'). See the documentation of <code><a href='cor_brms.html'>cor_brms</a></code> for
a description of the available correlation structures. Defaults to
<code>NULL</code>, corresponding to no correlations. In multivariate models,
<code>autocor</code> might also be a list of autocorrelation structures.
It is now recommend to specify autocorrelation terms directly
within <code>formula</code>. See <code><a href='brmsformula.html'>brmsformula</a></code> for more details.</p></td>
    </tr>
    <tr>
      <th>cov_ranef</th>
      <td><p>(Deprecated) A list of matrices that are proportional to the
(within) covariance structure of the group-level effects. The names of the
matrices should correspond to columns in <code>data</code> that are used as
grouping factors. All levels of the grouping factor should appear as
rownames of the corresponding matrix. This argument can be used, among
others to model pedigrees and phylogenetic effects. 
It is now recommended to specify those matrices in the formula
interface using the <code><a href='gr.html'>gr</a></code> and related functions. See
<code><a href='../articles/brms_phylogenetics.html'>vignette("brms_phylogenetics")</a></code> for more details.</p></td>
    </tr>
    <tr>
      <th>sample_prior</th>
      <td><p>Indicate if samples from priors should be drawn
additionally to the posterior samples. Options are <code>"no"</code> (the
default), <code>"yes"</code>, and <code>"only"</code>. Among others, these samples can
be used to calculate Bayes factors for point hypotheses via
<code><a href='hypothesis.brmsfit.html'>hypothesis</a></code>. Please note that improper priors are not sampled,
including the default improper priors used by <code>brm</code>. See
<code><a href='set_prior.html'>set_prior</a></code> on how to set (proper) priors. Please also note
that prior samples for the overall intercept are not obtained by default
for technical reasons. See <code><a href='brmsformula.html'>brmsformula</a></code> how to obtain prior
samples for the intercept. If <code>sample_prior</code> is set to <code>"only"</code>,
samples are drawn solely from the priors ignoring the likelihood, which
allows among others to generate samples from the prior predictive
distribution. In this case, all parameters must have proper priors.</p></td>
    </tr>
    <tr>
      <th>sparse</th>
      <td><p>(Deprecated) Logical; indicates whether the population-level
design matrices should be treated as sparse (defaults to <code>FALSE</code>). For
design matrices with many zeros, this can considerably reduce required
memory. Sampling speed is currently not improved or even slightly
decreased. It is now recommended to use the <code>sparse</code> argument of
<code><a href='brmsformula.html'>brmsformula</a></code> and related functions.</p></td>
    </tr>
    <tr>
      <th>knots</th>
      <td><p>Optional list containing user specified knot values to be used
for basis construction of smoothing terms. See
<code><a href='https://rdrr.io/pkg/mgcv/man/gamm.html'>gamm</a></code> for more details.</p></td>
    </tr>
    <tr>
      <th>stanvars</th>
      <td><p>An optional <code>stanvars</code> object generated by function
<code><a href='stanvar.html'>stanvar</a></code> to define additional variables for use in
<span class="pkg">Stan</span>'s program blocks.</p></td>
    </tr>
    <tr>
      <th>stan_funs</th>
      <td><p>(Deprecated) An optional character string containing
self-defined  <span class="pkg">Stan</span> functions, which will be included in the functions
block of the generated <span class="pkg">Stan</span> code. It is now recommended to use the
<code>stanvars</code> argument for this purpose instead.</p></td>
    </tr>
    <tr>
      <th>recompile</th>
      <td><p>Logical, indicating whether the Stan model should be
recompiled for every imputed data set. Defaults to <code>FALSE</code>. If
<code>NULL</code>, <code>brm_multiple</code> tries to figure out internally, if recompilation
is necessary, for example because data-dependent priors have changed.
Using the default of no recompilation should be fine in most cases.</p></td>
    </tr>
    <tr>
      <th>combine</th>
      <td><p>Logical; Indicates if the fitted models should be combined
into a single fitted model object via <code><a href='combine_models.html'>combine_models</a></code>.
Defaults to <code>TRUE</code>.</p></td>
    </tr>
    <tr>
      <th>fit</th>
      <td><p>An instance of S3 class <code>brmsfit_multiple</code> derived from a
previous fit; defaults to <code>NA</code>. If <code>fit</code> is of class
<code>brmsfit_multiple</code>, the compiled model associated with the fitted
result is re-used and all arguments modifying the model code or data are
ignored. It is not recommended to use this argument directly, but to call
the <code><a href='update.brmsfit_multiple.html'>update</a></code> method, instead.</p></td>
    </tr>
    <tr>
      <th>seed</th>
      <td><p>The seed for random number generation to make results
reproducible. If <code>NA</code> (the default), <span class="pkg">Stan</span> will set the seed
randomly.</p></td>
    </tr>
    <tr>
      <th>file</th>
      <td><p>Either <code>NULL</code> or a character string. In the latter case, the
fitted model object is saved via <code><a href='https://rdrr.io/r/base/readRDS.html'>saveRDS</a></code> in a file named
after the string supplied in <code>file</code>. The <code>.rds</code> extension is
added automatically. If the file already exists, <code>brm</code> will load and
return the saved model object instead of refitting the model. As existing
files won't be overwritten, you have to manually remove the file in order
to refit and save the model under an existing file name. The file name
is stored in the <code>brmsfit</code> object for later usage.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Further arguments passed to <code><a href='brm.html'>brm</a></code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>If <code>combine = TRUE</code> a <code>brmsfit_multiple</code> object, which
  inherits from class <code>brmsfit</code> and behaves essentially the same. If
  <code>combine = FALSE</code> a list of <code>brmsfit</code> objects.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The combined model may issue false positive convergence warnings, as
  the MCMC chains corresponding to different datasets may not necessarily
  overlap, even if each of the original models did converge. To find out
  whether each of the original models converged, investigate
  <code>fit$rhats</code>, where <code>fit</code> denotes the output of
  <code>brm_multiple</code>.</p>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Paul-Christian Buerkner <a href='mailto:paul.buerkner@gmail.com'>paul.buerkner@gmail.com</a></p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/amices/mice'>mice</a></span><span class='op'>)</span>
<span class='va'>imp</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://amices.org/mice/reference/mice.html'>mice</a></span><span class='op'>(</span><span class='va'>nhanes2</span><span class='op'>)</span>

<span class='co'># fit the model using mice and lm</span>
<span class='va'>fit_imp1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/with.html'>with</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span><span class='op'>(</span><span class='va'>bmi</span> <span class='op'>~</span> <span class='va'>age</span> <span class='op'>+</span> <span class='va'>hyp</span> <span class='op'>+</span> <span class='va'>chl</span><span class='op'>)</span>, data <span class='op'>=</span> <span class='va'>imp</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='fu'><a href='https://amices.org/mice/reference/pool.html'>pool</a></span><span class='op'>(</span><span class='va'>fit_imp1</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># fit the model using brms</span>
<span class='va'>fit_imp2</span> <span class='op'>&lt;-</span> <span class='fu'>brm_multiple</span><span class='op'>(</span><span class='va'>bmi</span> <span class='op'>~</span> <span class='va'>age</span> <span class='op'>+</span> <span class='va'>hyp</span> <span class='op'>+</span> <span class='va'>chl</span>, data <span class='op'>=</span> <span class='va'>imp</span>, chains <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>fit_imp2</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>fit_imp2</span>, pars <span class='op'>=</span> <span class='st'>"^b_"</span><span class='op'>)</span>
<span class='co'># investigate convergence of the original models</span>
<span class='va'>fit_imp2</span><span class='op'>$</span><span class='va'>rhats</span>

<span class='co'># use the future package for parallelization</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/HenrikBengtsson/future'>future</a></span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/future/man/plan.html'>plan</a></span><span class='op'>(</span><span class='va'>multiprocess</span><span class='op'>)</span>
<span class='va'>fit_imp3</span> <span class='op'>&lt;-</span> <span class='fu'>brm_multiple</span><span class='op'>(</span><span class='va'>bmi</span><span class='op'>~</span><span class='va'>age</span><span class='op'>+</span><span class='va'>hyp</span><span class='op'>+</span><span class='va'>chl</span>, data <span class='op'>=</span> <span class='va'>imp</span>, chains <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>fit_imp3</span><span class='op'>)</span>
<span class='op'>}</span>

</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Paul-Christian Bürkner.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


