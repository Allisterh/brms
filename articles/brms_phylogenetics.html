<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Estimating Phylogenetic Multilevel Models with brms • brms</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Estimating Phylogenetic Multilevel Models with brms">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">brms</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.8.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Other Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="http://mc-stan.org/rstan">rstan</a>
    </li>
    <li>
      <a href="http://mc-stan.org/rstanarm">rstanarm</a>
    </li>
    <li>
      <a href="http://mc-stan.org/bayesplot">bayesplot</a>
    </li>
    <li>
      <a href="http://mc-stan.org/shinystan">shinystan</a>
    </li>
    <li>
      <a href="http://mc-stan.org/loo">loo</a>
    </li>
    <li>
      <a href="http://mc-stan.org/projpred">projpred</a>
    </li>
    <li>
      <a href="http://mc-stan.org/rstantools">rstantools</a>
    </li>
  </ul>
</li>
<li>
  <a href="http://mc-stan.org">Stan</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://twitter.com/mcmc_stan">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/stan-dev/brms">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="http://discourse.mc-stan.org/">
    <span class="fa fa-users"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Estimating Phylogenetic Multilevel Models with brms</h1>
                        <h4 class="author">Paul Bürkner</h4>
            
            <h4 class="date">2019-03-14</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/paul-buerkner/brms/blob/master/vignettes/brms_phylogenetics.Rmd"><code>vignettes/brms_phylogenetics.Rmd</code></a></small>
      <div class="hidden name"><code>brms_phylogenetics.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>In the present vignette, we want to discuss how to specify phylogenetic multilevel models using <strong>brms</strong>. These models are relevant in evolutionary biology when data of many species are analyzed at the same time. The usual approach would be to model species as a grouping factor in a multilevel model and estimate varying intercepts (and possibly also varying slopes) over species. However, species are not independent as they come from the same phylogenetic tree and we thus have to adjust our model to incorporate this dependency. The examples discussed here are from chapter 11 of the book <em>Modern Phylogenetic Comparative Methods and the application in Evolutionary Biology</em> (de Villemeruil &amp; Nakagawa, 2014). The necessary data can be downloaded from the corresponding website (<a href="http://www.mpcm-evolution.com/" class="uri">http://www.mpcm-evolution.com/</a>). Some of these models may take a few minutes to fit.</p>
</div>
<div id="a-simple-phylogenetic-model" class="section level2">
<h2 class="hasAnchor">
<a href="#a-simple-phylogenetic-model" class="anchor"></a>A Simple Phylogenetic Model</h2>
<p>Assume we have measurements of a phenotype, <code>phen</code> (say the body size), and a <code>cofactor</code> variable (say the temperature of the environment). We prepare the data using the following code.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">phylo &lt;-<span class="st"> </span>ape<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/ape/topics/read.nexus">read.nexus</a></span>(<span class="st">"https://paul-buerkner.github.io/data/phylo.nex"</span>)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">data_simple &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/read.table">read.table</a></span>(</a>
<a class="sourceLine" id="cb1-3" data-line-number="3">  <span class="st">"https://paul-buerkner.github.io/data/data_simple.txt"</span>, </a>
<a class="sourceLine" id="cb1-4" data-line-number="4">  <span class="dt">header =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5">)</a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(data_simple)</a></code></pre></div>
<pre><code>       phen  cofactor phylo
1 107.06595 10.309588  sp_1
2  79.61086  9.690507  sp_2
3 116.38186 15.007825  sp_3
4 143.28705 19.087673  sp_4
5 139.60993 15.658404  sp_5
6  68.50657  6.005236  sp_6</code></pre>
<p>The <code>phylo</code> object contains information on the relationship between species. Using this information, we can construct a covariance matrix of species (Hadfield &amp; Nakagawa, 2010).</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">inv.phylo &lt;-<span class="st"> </span>MCMCglmm<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/MCMCglmm/topics/inverseA">inverseA</a></span>(phylo, <span class="dt">nodes =</span> <span class="st">"TIPS"</span>, <span class="dt">scale =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">A &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/solve">solve</a></span>(inv.phylo<span class="op">$</span>Ainv)</a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(A) &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(inv.phylo<span class="op">$</span>Ainv)</a></code></pre></div>
<p>In contrast to <strong>MCMCglmm</strong>, <strong>brms</strong> requires the covariance matrix and not its inverse. Now, we are ready to fit our first phylogenetic multilevel model:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">model_simple &lt;-<span class="st"> </span><span class="kw"><a href="../reference/brm.html">brm</a></span>(</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">  phen <span class="op">~</span><span class="st"> </span>cofactor <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span><span class="op">|</span>phylo), <span class="dt">data =</span> data_simple, </a>
<a class="sourceLine" id="cb4-3" data-line-number="3">  <span class="dt">family =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/family">gaussian</a></span>(), <span class="dt">cov_ranef =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">phylo =</span> A),</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">  <span class="dt">prior =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(</a>
<a class="sourceLine" id="cb4-5" data-line-number="5">    <span class="kw"><a href="../reference/set_prior.html">prior</a></span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="st">"b"</span>),</a>
<a class="sourceLine" id="cb4-6" data-line-number="6">    <span class="kw"><a href="../reference/set_prior.html">prior</a></span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">50</span>), <span class="st">"Intercept"</span>),</a>
<a class="sourceLine" id="cb4-7" data-line-number="7">    <span class="kw"><a href="../reference/set_prior.html">prior</a></span>(<span class="kw">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">20</span>), <span class="st">"sd"</span>),</a>
<a class="sourceLine" id="cb4-8" data-line-number="8">    <span class="kw"><a href="../reference/set_prior.html">prior</a></span>(<span class="kw">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">20</span>), <span class="st">"sigma"</span>)</a>
<a class="sourceLine" id="cb4-9" data-line-number="9">  )</a>
<a class="sourceLine" id="cb4-10" data-line-number="10">)</a></code></pre></div>
<p>With the exception of <code>cov_ranef = list(phylo = A)</code> this is a basic multilevel model with a varying intercept over species (<code>phylo</code> is an indicator of species in this data set). However, by using the <code>cov_ranef</code> argument, we make sure that species are correlated as specified by the covariance matrix <code>A</code>. Setting priors is not required for achieving good convergence for this model, but it improves sampling speed a bit. After fitting, the results can be investigated in detail.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/summary">summary</a></span>(model_simple)</a></code></pre></div>
<pre><code> Family: gaussian 
  Links: mu = identity; sigma = identity 
Formula: phen ~ cofactor + (1 | phylo) 
   Data: data_simple (Number of observations: 200) 
Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup samples = 4000

Group-Level Effects: 
~phylo (Number of levels: 200) 
              Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
sd(Intercept)    14.46      2.15    10.50    18.95        827 1.00

Population-Level Effects: 
          Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
Intercept    38.25      7.04    23.98    52.14       2399 1.00
cofactor      5.18      0.14     4.91     5.44       6654 1.00

Family Specific Parameters: 
      Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
sigma     9.21      0.72     7.84    10.68       1076 1.00

Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
is a crude measure of effective sample size, and Rhat is the potential 
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(model_simple, <span class="dt">N =</span> <span class="dv">2</span>, <span class="dt">ask =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<p><img src="brms_phylogenetics_files/figure-html/unnamed-chunk-4-1.png" width="60%" style="display: block; margin: auto;"><img src="brms_phylogenetics_files/figure-html/unnamed-chunk-4-2.png" width="60%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(<span class="kw"><a href="../reference/marginal_effects.html">marginal_effects</a></span>(model_simple), <span class="dt">points =</span> <span class="ot">TRUE</span>) </a></code></pre></div>
<p><img src="brms_phylogenetics_files/figure-html/unnamed-chunk-4-3.png" width="60%" style="display: block; margin: auto;"></p>
<p>The so called phylogenetic signal (often symbolize by <span class="math inline">\(\lambda\)</span>) can be computed with the <code>hypothesis</code> method and is roughly <span class="math inline">\(\lambda = 0.7\)</span> for this example.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">hyp &lt;-<span class="st"> "sd_phylo__Intercept^2 / (sd_phylo__Intercept^2 + sigma^2) = 0"</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2">(hyp &lt;-<span class="st"> </span><span class="kw"><a href="../reference/hypothesis.html">hypothesis</a></span>(model_simple, hyp, <span class="dt">class =</span> <span class="ot">NULL</span>))</a></code></pre></div>
<pre><code>Hypothesis Tests for class :
                Hypothesis Estimate Est.Error CI.Lower CI.Upper Evid.Ratio Post.Prob Star
1 (sd_phylo__Interc... = 0      0.7      0.08     0.52     0.84         NA        NA    *
---
'*': The expected value under the hypothesis lies outside the 95%-CI.
Posterior probabilities of point hypotheses assume equal prior probabilities.</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(hyp)</a></code></pre></div>
<p><img src="brms_phylogenetics_files/figure-html/unnamed-chunk-5-1.png" width="60%" style="display: block; margin: auto;"></p>
<p>Note that the phylogenetic signal is just a synonym of the intra-class correlation (ICC) used in the context phylogenetic analysis.</p>
</div>
<div id="a-phylogenetic-model-with-repeated-measurements" class="section level2">
<h2 class="hasAnchor">
<a href="#a-phylogenetic-model-with-repeated-measurements" class="anchor"></a>A Phylogenetic Model with Repeated Measurements</h2>
<p>Often, we have multiple observations per species and this allows to fit more complicated phylogenetic models.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">data_repeat &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/read.table">read.table</a></span>(</a>
<a class="sourceLine" id="cb12-2" data-line-number="2">  <span class="st">"https://paul-buerkner.github.io/data/data_repeat.txt"</span>, </a>
<a class="sourceLine" id="cb12-3" data-line-number="3">  <span class="dt">header =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb12-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb12-5" data-line-number="5">data_repeat<span class="op">$</span>spec_mean_cf &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb12-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/with">with</a></span>(data_repeat, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">sapply</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/split">split</a></span>(cofactor, phylo), mean)[phylo])</a>
<a class="sourceLine" id="cb12-7" data-line-number="7"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(data_repeat)</a></code></pre></div>
<pre><code>       phen  cofactor species phylo spec_mean_cf
1 107.41919 11.223724    sp_1  sp_1    10.309588
2 109.16403  9.805934    sp_1  sp_1    10.309588
3  91.88672 10.308423    sp_1  sp_1    10.309588
4 121.54341  8.355349    sp_1  sp_1    10.309588
5 105.31638 11.854510    sp_1  sp_1    10.309588
6  64.99859  4.314015    sp_2  sp_2     3.673914</code></pre>
<p>The variable <code>spec_mean_cf</code> just contains the mean of the cofactor for each species. The code for the repeated measurement phylogenetic model looks as follows:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">model_repeat1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/brm.html">brm</a></span>(</a>
<a class="sourceLine" id="cb14-2" data-line-number="2">  phen <span class="op">~</span><span class="st"> </span>spec_mean_cf <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span><span class="op">|</span>phylo) <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span><span class="op">|</span>species), </a>
<a class="sourceLine" id="cb14-3" data-line-number="3">  <span class="dt">data =</span> data_repeat, <span class="dt">family =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/family">gaussian</a></span>(), </a>
<a class="sourceLine" id="cb14-4" data-line-number="4">  <span class="dt">cov_ranef =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">phylo =</span> A),</a>
<a class="sourceLine" id="cb14-5" data-line-number="5">  <span class="dt">prior =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(</a>
<a class="sourceLine" id="cb14-6" data-line-number="6">    <span class="kw"><a href="../reference/set_prior.html">prior</a></span>(<span class="kw">normal</span>(<span class="dv">0</span>,<span class="dv">10</span>), <span class="st">"b"</span>),</a>
<a class="sourceLine" id="cb14-7" data-line-number="7">    <span class="kw"><a href="../reference/set_prior.html">prior</a></span>(<span class="kw">normal</span>(<span class="dv">0</span>,<span class="dv">50</span>), <span class="st">"Intercept"</span>),</a>
<a class="sourceLine" id="cb14-8" data-line-number="8">    <span class="kw"><a href="../reference/set_prior.html">prior</a></span>(<span class="kw">student_t</span>(<span class="dv">3</span>,<span class="dv">0</span>,<span class="dv">20</span>), <span class="st">"sd"</span>),</a>
<a class="sourceLine" id="cb14-9" data-line-number="9">    <span class="kw"><a href="../reference/set_prior.html">prior</a></span>(<span class="kw">student_t</span>(<span class="dv">3</span>,<span class="dv">0</span>,<span class="dv">20</span>), <span class="st">"sigma"</span>)</a>
<a class="sourceLine" id="cb14-10" data-line-number="10">  ),</a>
<a class="sourceLine" id="cb14-11" data-line-number="11">  <span class="dt">sample_prior =</span> <span class="ot">TRUE</span>, <span class="dt">chains =</span> <span class="dv">2</span>, <span class="dt">cores =</span> <span class="dv">2</span>, </a>
<a class="sourceLine" id="cb14-12" data-line-number="12">  <span class="dt">iter =</span> <span class="dv">4000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span></a>
<a class="sourceLine" id="cb14-13" data-line-number="13">)</a></code></pre></div>
<p>The variables <code>phylo</code> and <code>species</code> are identical as they are both identifiers of the species. However, we model the phylogenetic covariance only for <code>phylo</code> and thus the <code>species</code> variable accounts for any specific effect that would be independent of the phylogenetic relationship between species (e.g., environmental or niche effects). Again we can obtain model summaries as well as estimates of the phylogenetic signal.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/summary">summary</a></span>(model_repeat1)</a></code></pre></div>
<pre><code> Family: gaussian 
  Links: mu = identity; sigma = identity 
Formula: phen ~ spec_mean_cf + (1 | phylo) + (1 | species) 
   Data: data_repeat (Number of observations: 1000) 
Samples: 2 chains, each with iter = 4000; warmup = 1000; thin = 1;
         total post-warmup samples = 6000

Group-Level Effects: 
~phylo (Number of levels: 200) 
              Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
sd(Intercept)    16.36      1.86    12.96    20.12       1829 1.00

~species (Number of levels: 200) 
              Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
sd(Intercept)     5.02      0.81     3.40     6.61       1353 1.00

Population-Level Effects: 
             Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
Intercept       36.20      7.86    20.35    51.48       4365 1.00
spec_mean_cf     5.09      0.10     4.90     5.29       7918 1.00

Family Specific Parameters: 
      Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
sigma     8.11      0.21     7.71     8.54       5490 1.00

Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
is a crude measure of effective sample size, and Rhat is the potential 
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">hyp &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste</a></span>(</a>
<a class="sourceLine" id="cb17-2" data-line-number="2">  <span class="st">"sd_phylo__Intercept^2 /"</span>, </a>
<a class="sourceLine" id="cb17-3" data-line-number="3">  <span class="st">"(sd_phylo__Intercept^2 + sd_species__Intercept^2 + sigma^2) = 0"</span></a>
<a class="sourceLine" id="cb17-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb17-5" data-line-number="5">(hyp &lt;-<span class="st"> </span><span class="kw"><a href="../reference/hypothesis.html">hypothesis</a></span>(model_repeat1, hyp, <span class="dt">class =</span> <span class="ot">NULL</span>))</a></code></pre></div>
<pre><code>Hypothesis Tests for class :
                Hypothesis Estimate Est.Error CI.Lower CI.Upper Evid.Ratio Post.Prob Star
1 (sd_phylo__Interc... = 0     0.74      0.06     0.62     0.83          0         0    *
---
'*': The expected value under the hypothesis lies outside the 95%-CI.
Posterior probabilities of point hypotheses assume equal prior probabilities.</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(hyp)</a></code></pre></div>
<p><img src="brms_phylogenetics_files/figure-html/unnamed-chunk-9-1.png" width="60%" style="display: block; margin: auto;"></p>
<p>So far, we have completely ignored the variability of the cofactor within species. To incorporate this into the model, we define</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">data_repeat<span class="op">$</span>within_spec_cf &lt;-<span class="st"> </span>data_repeat<span class="op">$</span>cofactor <span class="op">-</span><span class="st"> </span>data_repeat<span class="op">$</span>spec_mean_cf</a></code></pre></div>
<p>and then fit it again using <code>within_spec_cf</code> as an additional predictor.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1">model_repeat2 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/update">update</a></span>(</a>
<a class="sourceLine" id="cb21-2" data-line-number="2">  model_repeat1, <span class="dt">formula =</span> <span class="op">~</span><span class="st"> </span>. <span class="op">+</span><span class="st"> </span>within_spec_cf,</a>
<a class="sourceLine" id="cb21-3" data-line-number="3">  <span class="dt">newdata =</span> data_repeat, <span class="dt">chains =</span> <span class="dv">2</span>, <span class="dt">cores =</span> <span class="dv">2</span>, </a>
<a class="sourceLine" id="cb21-4" data-line-number="4">  <span class="dt">iter =</span> <span class="dv">4000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span></a>
<a class="sourceLine" id="cb21-5" data-line-number="5">)</a></code></pre></div>
<p>The results are almost unchanged, with apparently no relationship between the phenotype and the within species variance of <code>cofactor</code>.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/summary">summary</a></span>(model_repeat2)</a></code></pre></div>
<pre><code> Family: gaussian 
  Links: mu = identity; sigma = identity 
Formula: phen ~ spec_mean_cf + (1 | phylo) + (1 | species) + within_spec_cf 
   Data: data_repeat (Number of observations: 1000) 
Samples: 2 chains, each with iter = 4000; warmup = 1000; thin = 1;
         total post-warmup samples = 6000

Group-Level Effects: 
~phylo (Number of levels: 200) 
              Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
sd(Intercept)    16.54      1.95    13.01    20.59        977 1.00

~species (Number of levels: 200) 
              Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
sd(Intercept)     4.92      0.93     3.06     6.54        462 1.00

Population-Level Effects: 
               Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
Intercept         36.21      7.85    20.12    51.19       3768 1.00
spec_mean_cf       5.10      0.10     4.90     5.30       7888 1.00
within_spec_cf    -0.06      0.18    -0.42     0.31       8555 1.00

Family Specific Parameters: 
      Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
sigma     8.11      0.20     7.72     8.51       5099 1.00

Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
is a crude measure of effective sample size, and Rhat is the potential 
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Also, the phylogenetic signal remains more or less the same.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1">hyp &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste</a></span>(</a>
<a class="sourceLine" id="cb24-2" data-line-number="2">  <span class="st">"sd_phylo__Intercept^2 /"</span>, </a>
<a class="sourceLine" id="cb24-3" data-line-number="3">  <span class="st">"(sd_phylo__Intercept^2 + sd_species__Intercept^2 + sigma^2) = 0"</span></a>
<a class="sourceLine" id="cb24-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb24-5" data-line-number="5">(hyp &lt;-<span class="st"> </span><span class="kw"><a href="../reference/hypothesis.html">hypothesis</a></span>(model_repeat2, hyp, <span class="dt">class =</span> <span class="ot">NULL</span>))</a></code></pre></div>
<pre><code>Hypothesis Tests for class :
                Hypothesis Estimate Est.Error CI.Lower CI.Upper Evid.Ratio Post.Prob Star
1 (sd_phylo__Interc... = 0     0.74      0.06     0.62     0.84          0         0    *
---
'*': The expected value under the hypothesis lies outside the 95%-CI.
Posterior probabilities of point hypotheses assume equal prior probabilities.</code></pre>
</div>
<div id="a-phylogenetic-meta-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#a-phylogenetic-meta-analysis" class="anchor"></a>A Phylogenetic Meta-Analysis</h2>
<p>Let’s say we have Fisher’s z-transformated correlation coefficients <span class="math inline">\(Zr\)</span> per species along with corresponding sample sizes (e.g., correlations between male coloration and reproductive success):</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1">data_fisher &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/read.table">read.table</a></span>(</a>
<a class="sourceLine" id="cb26-2" data-line-number="2">  <span class="st">"https://paul-buerkner.github.io/data/data_effect.txt"</span>, </a>
<a class="sourceLine" id="cb26-3" data-line-number="3">  <span class="dt">header =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb26-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb26-5" data-line-number="5">data_fisher<span class="op">$</span>obs &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(data_fisher)</a>
<a class="sourceLine" id="cb26-6" data-line-number="6"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(data_fisher)</a></code></pre></div>
<pre><code>          Zr  N phylo obs
1 0.28917549 13  sp_1   1
2 0.02415579 40  sp_2   2
3 0.19513651 39  sp_3   3
4 0.09831239 40  sp_4   4
5 0.13780152 66  sp_5   5
6 0.13710587 41  sp_6   6</code></pre>
<p>We assume the sampling variance to be known and as <span class="math inline">\(V(Zr) = \frac{1}{N - 3}\)</span> for Fisher’s values, where <span class="math inline">\(N\)</span> is the sample size per species. Incorporating the known sampling variance into the model is straight forward. One has to keep in mind though, that <strong>brms</strong> requires the sampling standard deviation (square root of the variance) as input instead of the variance itself. The group-level effect of <code>obs</code> represents the residual variance, which we have to model explicitly in a meta-analytic model.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1">model_fisher &lt;-<span class="st"> </span><span class="kw"><a href="../reference/brm.html">brm</a></span>(</a>
<a class="sourceLine" id="cb28-2" data-line-number="2">  Zr <span class="op">|</span><span class="st"> </span><span class="kw">se</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/MathFun">sqrt</a></span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span>(N <span class="op">-</span><span class="st"> </span><span class="dv">3</span>))) <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span><span class="op">|</span>phylo) <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span><span class="op">|</span>obs), </a>
<a class="sourceLine" id="cb28-3" data-line-number="3">  <span class="dt">data =</span> data_fisher, <span class="dt">family =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/family">gaussian</a></span>(), </a>
<a class="sourceLine" id="cb28-4" data-line-number="4">  <span class="dt">cov_ranef =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">phylo =</span> A),</a>
<a class="sourceLine" id="cb28-5" data-line-number="5">  <span class="dt">prior =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(</a>
<a class="sourceLine" id="cb28-6" data-line-number="6">    <span class="kw"><a href="../reference/set_prior.html">prior</a></span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="st">"Intercept"</span>),</a>
<a class="sourceLine" id="cb28-7" data-line-number="7">    <span class="kw"><a href="../reference/set_prior.html">prior</a></span>(<span class="kw">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">10</span>), <span class="st">"sd"</span>)</a>
<a class="sourceLine" id="cb28-8" data-line-number="8">  ),</a>
<a class="sourceLine" id="cb28-9" data-line-number="9">  <span class="dt">control =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">adapt_delta =</span> <span class="fl">0.95</span>),</a>
<a class="sourceLine" id="cb28-10" data-line-number="10">  <span class="dt">chains =</span> <span class="dv">2</span>, <span class="dt">cores =</span> <span class="dv">2</span>, <span class="dt">iter =</span> <span class="dv">4000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span></a>
<a class="sourceLine" id="cb28-11" data-line-number="11">)</a></code></pre></div>
<p>A summary of the fitted model is obtained via</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/summary">summary</a></span>(model_fisher)</a></code></pre></div>
<pre><code> Family: gaussian 
  Links: mu = identity; sigma = identity 
Formula: Zr | se(sqrt(1/(N - 3))) ~ 1 + (1 | phylo) + (1 | obs) 
   Data: data_fisher (Number of observations: 200) 
Samples: 2 chains, each with iter = 4000; warmup = 1000; thin = 1;
         total post-warmup samples = 6000

Group-Level Effects: 
~obs (Number of levels: 200) 
              Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
sd(Intercept)     0.05      0.03     0.00     0.11        934 1.00

~phylo (Number of levels: 200) 
              Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
sd(Intercept)     0.07      0.04     0.01     0.15        985 1.00

Population-Level Effects: 
          Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
Intercept     0.16      0.04     0.07     0.24       3474 1.00

Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
is a crude measure of effective sample size, and Rhat is the potential 
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(model_fisher)</a></code></pre></div>
<p><img src="brms_phylogenetics_files/figure-html/unnamed-chunk-16-1.png" width="60%" style="display: block; margin: auto;"></p>
<p>The meta-analytic mean (i.e., the model intercept) is <span class="math inline">\(0.16\)</span> with a credible interval of <span class="math inline">\([0.08, 0.25]\)</span>. Thus the mean correlation across species is positive according to the model.</p>
</div>
<div id="a-phylogenetic-count-data-model" class="section level2">
<h2 class="hasAnchor">
<a href="#a-phylogenetic-count-data-model" class="anchor"></a>A phylogenetic count-data model</h2>
<p>Suppose that we analyze a phenotype that consists of counts instead of being a continuous variable. In such a case, the normality assumption will likely not be justified and it is recommended to use a distribution explicitely suited for count data, for instance the Poisson distribution. The following data set (again retrieved from mpcm-evolution.org) provides an example.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1">data_pois &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/read.table">read.table</a></span>(</a>
<a class="sourceLine" id="cb32-2" data-line-number="2">  <span class="st">"https://paul-buerkner.github.io/data/data_pois.txt"</span>, </a>
<a class="sourceLine" id="cb32-3" data-line-number="3">  <span class="dt">header =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb32-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb32-5" data-line-number="5">data_pois<span class="op">$</span>obs &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(data_pois)</a>
<a class="sourceLine" id="cb32-6" data-line-number="6"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(data_pois)</a></code></pre></div>
<pre><code>  phen_pois   cofactor phylo obs
1         1  7.8702830  sp_1   1
2         0  3.4690529  sp_2   2
3         1  2.5478774  sp_3   3
4        14 18.2286628  sp_4   4
5         1  2.5302806  sp_5   5
6         1  0.5145559  sp_6   6</code></pre>
<p>As the poisson distribution does not have a natural overdispersion parameter, we model the residual variance via the group-level effects of <code>obs</code> (e.g., see Lawless, 1987).</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1">model_pois &lt;-<span class="st"> </span><span class="kw"><a href="../reference/brm.html">brm</a></span>(</a>
<a class="sourceLine" id="cb34-2" data-line-number="2">  phen_pois <span class="op">~</span><span class="st"> </span>cofactor <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span><span class="op">|</span>phylo) <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span><span class="op">|</span>obs), </a>
<a class="sourceLine" id="cb34-3" data-line-number="3">  <span class="dt">data =</span> data_pois, <span class="dt">family =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/family">poisson</a></span>(<span class="st">"log"</span>), </a>
<a class="sourceLine" id="cb34-4" data-line-number="4">  <span class="dt">cov_ranef =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">phylo =</span> A),</a>
<a class="sourceLine" id="cb34-5" data-line-number="5">  <span class="dt">chains =</span> <span class="dv">2</span>, <span class="dt">cores =</span> <span class="dv">2</span>, <span class="dt">iter =</span> <span class="dv">4000</span>,</a>
<a class="sourceLine" id="cb34-6" data-line-number="6">  <span class="dt">control =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">adapt_delta =</span> <span class="fl">0.95</span>)</a>
<a class="sourceLine" id="cb34-7" data-line-number="7">)</a></code></pre></div>
<p>Again, we obtain a summary of the fitted model via</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/summary">summary</a></span>(model_pois)</a></code></pre></div>
<pre><code> Family: poisson 
  Links: mu = log 
Formula: phen_pois ~ cofactor + (1 | phylo) + (1 | obs) 
   Data: data_pois (Number of observations: 200) 
Samples: 2 chains, each with iter = 4000; warmup = 2000; thin = 1;
         total post-warmup samples = 4000

Group-Level Effects: 
~obs (Number of levels: 200) 
              Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
sd(Intercept)     0.19      0.08     0.02     0.34        792 1.00

~phylo (Number of levels: 200) 
              Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
sd(Intercept)     0.18      0.10     0.02     0.41        903 1.01

Population-Level Effects: 
          Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
Intercept    -2.08      0.21    -2.49    -1.69       5141 1.00
cofactor      0.25      0.01     0.23     0.27       6283 1.00

Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
is a crude measure of effective sample size, and Rhat is the potential 
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(<span class="kw"><a href="../reference/marginal_effects.html">marginal_effects</a></span>(model_pois), <span class="dt">points =</span> <span class="ot">TRUE</span>) </a></code></pre></div>
<p><img src="brms_phylogenetics_files/figure-html/unnamed-chunk-19-1.png" width="60%" style="display: block; margin: auto;"></p>
<p>Now, assume we ignore the fact that the phenotype is count data and fit a linear normal model instead.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" data-line-number="1">model_normal &lt;-<span class="st"> </span><span class="kw"><a href="../reference/brm.html">brm</a></span>(</a>
<a class="sourceLine" id="cb38-2" data-line-number="2">  phen_pois <span class="op">~</span><span class="st"> </span>cofactor <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span><span class="op">|</span>phylo), </a>
<a class="sourceLine" id="cb38-3" data-line-number="3">  <span class="dt">data =</span> data_pois, <span class="dt">family =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/family">gaussian</a></span>(), </a>
<a class="sourceLine" id="cb38-4" data-line-number="4">  <span class="dt">cov_ranef =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">phylo =</span> A),</a>
<a class="sourceLine" id="cb38-5" data-line-number="5">  <span class="dt">chains =</span> <span class="dv">2</span>, <span class="dt">cores =</span> <span class="dv">2</span>, <span class="dt">iter =</span> <span class="dv">4000</span>,</a>
<a class="sourceLine" id="cb38-6" data-line-number="6">  <span class="dt">control =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">adapt_delta =</span> <span class="fl">0.95</span>)</a>
<a class="sourceLine" id="cb38-7" data-line-number="7">)</a></code></pre></div>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/summary">summary</a></span>(model_normal)</a></code></pre></div>
<pre><code> Family: gaussian 
  Links: mu = identity; sigma = identity 
Formula: phen_pois ~ cofactor + (1 | phylo) 
   Data: data_pois (Number of observations: 200) 
Samples: 2 chains, each with iter = 4000; warmup = 2000; thin = 1;
         total post-warmup samples = 4000

Group-Level Effects: 
~phylo (Number of levels: 200) 
              Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
sd(Intercept)     0.73      0.54     0.03     2.08        787 1.00

Population-Level Effects: 
          Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
Intercept    -3.00      0.65    -4.30    -1.74       2684 1.00
cofactor      0.68      0.04     0.60     0.76       7225 1.00

Family Specific Parameters: 
      Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
sigma     3.45      0.19     3.11     3.83       3408 1.00

Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
is a crude measure of effective sample size, and Rhat is the potential 
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>We see that <code>cofactor</code> has a positive relationship with the phenotype in both models. One should keep in mind, though, that the estimates of the Poisson model are on the log-scale, as we applied the canonical log-link function in this example. Therefore, estimates are not comparable to a linear normal model even if applied to the same data. What we can compare, however, is the model fit, for instance graphically via posterior predictive checks.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" data-line-number="1"><span class="kw"><a href="../reference/pp_check.brmsfit.html">pp_check</a></span>(model_pois)</a></code></pre></div>
<p><img src="brms_phylogenetics_files/figure-html/unnamed-chunk-22-1.png" width="60%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" data-line-number="1"><span class="kw"><a href="../reference/pp_check.brmsfit.html">pp_check</a></span>(model_normal)</a></code></pre></div>
<p><img src="brms_phylogenetics_files/figure-html/unnamed-chunk-22-2.png" width="60%" style="display: block; margin: auto;"></p>
<p>Apparently, the distribution of the phenotype predicted by the Poisson model resembles the original distribution of the phenotype pretty closely, while the normal models fails to do so. We can also apply leave-one-out cross-validation for direct numerical comparison of model fit.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" data-line-number="1"><span class="kw"><a href="../reference/loo.brmsfit.html">loo</a></span>(model_pois, model_normal)</a></code></pre></div>
<pre><code>Output of model 'model_pois':

Computed from 4000 by 200 log-likelihood matrix

         Estimate   SE
elpd_loo   -348.2 17.0
p_loo        30.2  3.4
looic       696.4 33.9
------
Monte Carlo SE of elpd_loo is 0.2.

Pareto k diagnostic values:
                         Count Pct.    Min. n_eff
(-Inf, 0.5]   (good)     166   83.0%   772       
 (0.5, 0.7]   (ok)        34   17.0%   201       
   (0.7, 1]   (bad)        0    0.0%   &lt;NA&gt;      
   (1, Inf)   (very bad)   0    0.0%   &lt;NA&gt;      

All Pareto k estimates are ok (k &lt; 0.7).
See help('pareto-k-diagnostic') for details.

Output of model 'model_normal':

Computed from 4000 by 200 log-likelihood matrix

         Estimate   SE
elpd_loo   -536.2 15.7
p_loo        10.7  2.3
looic      1072.3 31.4
------
Monte Carlo SE of elpd_loo is 0.1.

Pareto k diagnostic values:
                         Count Pct.    Min. n_eff
(-Inf, 0.5]   (good)     196   98.0%   718       
 (0.5, 0.7]   (ok)         4    2.0%   2011      
   (0.7, 1]   (bad)        0    0.0%   &lt;NA&gt;      
   (1, Inf)   (very bad)   0    0.0%   &lt;NA&gt;      

All Pareto k estimates are ok (k &lt; 0.7).
See help('pareto-k-diagnostic') for details.

Model comparisons:
             elpd_diff se_diff
model_pois      0.0       0.0 
model_normal -187.9      17.9 </code></pre>
<p>Since smaller values of loo indicate better fit, it is again evident that the Poisson model fits the data better than the normal model. Of course, the Poisson model is not the only reasonable option here. For instance, you could use a negative binomial model (via family <code>negative_binomial</code>), which already contains an overdispersion parameter so that modeling a varying intercept of <code>obs</code> becomes obsolete.</p>
</div>
<div id="phylogenetic-models-with-multiple-group-level-effects" class="section level2">
<h2 class="hasAnchor">
<a href="#phylogenetic-models-with-multiple-group-level-effects" class="anchor"></a>Phylogenetic models with multiple group-level effects</h2>
<p>In the above examples, we have only used a single group-level effect (i.e., a varying intercept) for the phylogenetic grouping factors. In <strong>brms</strong>, it is also possible to estimate multiple group-level effects (e.g., a varying intercept and a varying slope) for these grouping factors. However, it requires repeatedly computing Kronecker products of covariance matrices while fitting the model. This will be very slow especially when the grouping factors have many levels and matrices are thus large.</p>
</div>
<div id="references" class="section level2">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<p>de Villemeruil P. &amp; Nakagawa, S. (2014) General quantitative genetic methods for comparative biology In: <em>Modern phylogenetic comparative methods and their application in evolutionary biology: concepts and practice</em> (ed. Garamszegi L.) Springer, New York. pp. 287-303.</p>
<p>Hadfield, J. D. &amp; Nakagawa, S. (2010) General quantitative genetic methods for comparative biology: phylogenies, taxonomies, and multi-trait models for continuous and categorical characters. <em>Journal of Evolutionary Biology</em>. 23. 494-508.</p>
<p>Lawless, J. F. (1987). Negative binomial and mixed Poisson regression. <em>Canadian Journal of Statistics</em>, 15(3), 209-225.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#a-simple-phylogenetic-model">A Simple Phylogenetic Model</a></li>
      <li><a href="#a-phylogenetic-model-with-repeated-measurements">A Phylogenetic Model with Repeated Measurements</a></li>
      <li><a href="#a-phylogenetic-meta-analysis">A Phylogenetic Meta-Analysis</a></li>
      <li><a href="#a-phylogenetic-count-data-model">A phylogenetic count-data model</a></li>
      <li><a href="#phylogenetic-models-with-multiple-group-level-effects">Phylogenetic models with multiple group-level effects</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Paul-Christian Bürkner.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.9000.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
