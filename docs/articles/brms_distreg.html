<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Estimating Distributional Models with brms • brms</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><meta property="og:title" content="Estimating Distributional Models with brms">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">brms</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">2.2.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Other Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="http://mc-stan.org/rstan">rstan</a>
    </li>
    <li>
      <a href="http://mc-stan.org/rstanarm">rstanarm</a>
    </li>
    <li>
      <a href="http://mc-stan.org/bayesplot">bayesplot</a>
    </li>
    <li>
      <a href="http://mc-stan.org/shinystan">shinystan</a>
    </li>
    <li>
      <a href="http://mc-stan.org/loo">loo</a>
    </li>
    <li>
      <a href="http://mc-stan.org/projpred">projpred</a>
    </li>
    <li>
      <a href="http://mc-stan.org/rstantools">rstantools</a>
    </li>
  </ul>
</li>
<li>
  <a href="http://mc-stan.org">Stan</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://twitter.com/mcmc_stan">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/stan-dev/brms">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="http://discourse.mc-stan.org/">
    <span class="fa fa-users"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Estimating Distributional Models with brms</h1>
                        <h4 class="author">Paul Bürkner</h4>
            
            <h4 class="date">2018-04-25</h4>
      
      

    </div>

    
    
<!--
%\VignetteEngine{knitr::rmarkdown}
%\VignetteIndexEntry{Fit Distributional Models with brms}
%\VignetteEncoding{UTF-8}
-->
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>This vignette provides an introduction on how to fit distributional regression models with <strong>brms</strong>. We use the term <em>distributional model</em> to refer to a model, in which we can specify predictor terms for all parameters of the assumed response distribution. In the vast majority of regression model implementations, only the location parameter (usually the mean) of the response distribution depends on the predictors and corresponding regression parameters. Other parameters (e.g., scale or shape parameters) are estimated as auxilliary parameters assuming them to be constant across observations. This assumption is so common that most researchers applying regression models are often (in my experience) not aware of the possibility of relaxing it. This is understandable insofar as relaxing this assumption drastically increase model complexity and thus makes models hard to fit. Fortunately, <strong>brms</strong> uses <strong>Stan</strong> on the backend, which is an incredibly flexible and powerful tool for estimating Bayesian models so that model complexity is much less of an issue.</p>
<p>Suppose we have a normally distributed response variable. Then, in basic linear regression, we specify a predictor term <span class="math inline">\(\eta_{\mu}\)</span> for the mean parameter <span class="math inline">\(\mu\)</span> of the normal distribution. The second parameter of the normal distribution – the residual standard deviation <span class="math inline">\(\sigma\)</span> – is assumed to be constant across observations. We estimate <span class="math inline">\(\sigma\)</span> but do not try to <em>predict</em> it. In a distributional model, however, we do exactly this by specifying a predictor term <span class="math inline">\(\eta_{\sigma}\)</span> for <span class="math inline">\(\sigma\)</span> in addition to the predictor term <span class="math inline">\(\eta_{\mu}\)</span>. Ignoring group-level effects for the moment, the linear predictor of a parameter <span class="math inline">\(\theta\)</span> for observation <span class="math inline">\(n\)</span> has the form</p>
<p><span class="math display">\[\eta_{\theta n} = \sum_{i = 1}^{K_{\theta}} b_{\theta i} x_{\theta i n}\]</span> where <span class="math inline">\(x_{\theta i n}\)</span> denotes the value of the <span class="math inline">\(i\)</span>th predictor of parameter <span class="math inline">\(\theta\)</span> for observation <span class="math inline">\(n\)</span> and <span class="math inline">\(b_{\theta i}\)</span> is the <span class="math inline">\(i\)</span>th regression coefficient of parameter <span class="math inline">\(\theta\)</span>. A distributional normal model with response variable <span class="math inline">\(y\)</span> can then be written as</p>
<p><span class="math display">\[y_n \sim \mathcal{N}\left(\eta_{\mu n}, \, \exp(\eta_{\sigma n}) \right)\]</span> We used the exponential function around <span class="math inline">\(\eta_{\sigma}\)</span> to reflect that <span class="math inline">\(\sigma\)</span> constitutes a standard deviation and thus only takes on positive values, while a linear predictor can be any real number.</p>
</div>
<div id="a-simple-distributional-model" class="section level2">
<h2 class="hasAnchor">
<a href="#a-simple-distributional-model" class="anchor"></a>A simple distributional model</h2>
<p>Unequal variance models are possibly the most simple, but nevertheless very important application of distributional models. Suppose we have two groups of patients: One group recieves a treatment (e.g., an antidepressive drug) and another group recieves placebo. Since the treatment may not work equally well for all patients, the symptom variance of the treatment group may be larger than the symptom variance of the placebo group after some weeks of treatment. For simplicity, assume that we only investigate the post-treatment values.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">group &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">"treat"</span>, <span class="st">"placebo"</span>), <span class="dt">each =</span> <span class="dv">30</span>)
symptom_post &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">rnorm</span>(<span class="dv">30</span>, <span class="dt">mean =</span> <span class="dv">1</span>, <span class="dt">sd =</span> <span class="dv">2</span>), <span class="kw">rnorm</span>(<span class="dv">30</span>, <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> <span class="dv">1</span>))
dat1 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(group, symptom_post)
<span class="kw">head</span>(dat1)</code></pre></div>
<p>The following model estimates the effect of <code>group</code> on both the mean and the residual standard deviation of the normal response distribution.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fit1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/brm.html">brm</a></span>(<span class="kw"><a href="../reference/brmsformula.html">bf</a></span>(symptom_post <span class="op">~</span><span class="st"> </span>group, sigma <span class="op">~</span><span class="st"> </span>group), 
            <span class="dt">data =</span> dat1, <span class="dt">family =</span> <span class="kw">gaussian</span>())</code></pre></div>
<p>Useful summary statistics and plots can be obtained via</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(fit1)
<span class="kw">plot</span>(fit1, <span class="dt">N =</span> <span class="dv">2</span>, <span class="dt">ask =</span> <span class="ot">FALSE</span>)
<span class="kw">plot</span>(<span class="kw"><a href="../reference/marginal_effects.html">marginal_effects</a></span>(fit1), <span class="dt">points =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p>The population-level effect <code>sigma_grouptreat</code>, which is the contrast of the two residual standard deviations on the log-scale, reveals that the variances of both groups are indeed different. This impression is confirmed when looking at the <code>marginal_effects</code> of <code>group</code>. Going one step further, we can compute the residual standard deviations on the original scale using the <code>hypothesis</code> method.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">hyp &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"exp(sigma_Intercept) = 0"</span>,
         <span class="st">"exp(sigma_Intercept + sigma_grouptreat) = 0"</span>)
<span class="kw"><a href="../reference/hypothesis.html">hypothesis</a></span>(fit1, hyp)</code></pre></div>
<p>We may also directly compare them and plot the posterior distribution of their difference.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">hyp &lt;-<span class="st"> "exp(sigma_Intercept + sigma_grouptreat) &gt; exp(sigma_Intercept)"</span>
(hyp &lt;-<span class="st"> </span><span class="kw"><a href="../reference/hypothesis.html">hypothesis</a></span>(fit1, hyp))
<span class="kw">plot</span>(hyp, <span class="dt">chars =</span> <span class="ot">NULL</span>)</code></pre></div>
<p>Indeed, the residual standard deviation of the treatment group seems to larger than that of the placebo group. Moreover the magnitude of this difference is pretty similar to what we expected due to the values we put into the data simulations.</p>
</div>
<div id="zero-inflated-models" class="section level2">
<h2 class="hasAnchor">
<a href="#zero-inflated-models" class="anchor"></a>Zero-Inflated Models</h2>
<p>Another important application of the distributional regression framework are so called zero-inflated models. These models are helpful whenever there are more zeros in the response variable than one would naturally expect. For example, if one seeks to predict the number of cigarettes people smoke per day and also includes non-smokers, there will be a huge amount of zeros which, when not modeled appropriately, can seriously distort parameter estimates. Here, we consider an example dealing with the number of fish caught by various groups of people. On the UCLA website (), the data are described as follows: “The state wildlife biologists want to model how many fish are being caught by fishermen at a state park. Visitors are asked how long they stayed, how many people were in the group, were there children in the group and how many fish were caught. Some visitors do not fish, but there is no data on whether a person fished or not. Some visitors who did fish did not catch any fish so there are excess zeros in the data because of the people that did not fish.”</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">zinb &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">"http://stats.idre.ucla.edu/stat/data/fish.csv"</span>)
<span class="kw">head</span>(zinb)</code></pre></div>
<p>As predictors we choose the number of people per group, the number of children, as well as whether the group consists of campers. Many groups may not even try catching any fish at all (thus leading to many zero responses) and so we fit a zero-inflated Poisson model to the data. For now, we assume a constant zero-inflation probability across observations.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fit_zinb1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/brm.html">brm</a></span>(count <span class="op">~</span><span class="st"> </span>persons <span class="op">+</span><span class="st"> </span>child <span class="op">+</span><span class="st"> </span>camper, 
                 <span class="dt">data =</span> zinb, <span class="dt">family =</span> <span class="kw"><a href="../reference/brmsfamily.html">zero_inflated_poisson</a></span>())</code></pre></div>
<p>Again, we summarize the results using the usual methods.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(fit_zinb1)
<span class="kw">plot</span>(<span class="kw"><a href="../reference/marginal_effects.html">marginal_effects</a></span>(fit_zinb1), <span class="dt">ask =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p>According to the parameter estimates, larger groups catch more fish, campers catch more fish than non-campers, and groups with more children catch less fish. The zero-inflation probability <code>zi</code> is pretty large with a mean of 41%. Please note that the probability of catching no fish is actually higher than 41%, but parts of this probability are already modeled by the poisson distribution itself (hence the name zero-<em>inflation</em>). If you want to treat all zeros as origniating from a separate process, you can use hurdle models instead (not shown here).</p>
<p>Now, we try to additionally predict the zero-inflation probability by the number of children. The underlying reasoning is that we expect groups with more children to not even try catching fish. Most children are just terribly bad at waiting for hours until something happens. From a purely statistical perspective, zero-inflated (and hurdle) distributions are a mixture of two processes and predicting both parts of the model is natural and often very reasonable to make full use of the data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fit_zinb2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/brm.html">brm</a></span>(<span class="kw"><a href="../reference/brmsformula.html">bf</a></span>(count <span class="op">~</span><span class="st"> </span>persons <span class="op">+</span><span class="st"> </span>child <span class="op">+</span><span class="st"> </span>camper, zi <span class="op">~</span><span class="st"> </span>child), 
                 <span class="dt">data =</span> zinb, <span class="dt">family =</span> <span class="kw"><a href="../reference/brmsfamily.html">zero_inflated_poisson</a></span>())</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(fit_zinb2)
<span class="kw">plot</span>(<span class="kw"><a href="../reference/marginal_effects.html">marginal_effects</a></span>(fit_zinb2), <span class="dt">ask =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p>To transform the linear predictor of <code>zi</code> into a probability, <strong>brms</strong> applies the logit-link:</p>
<p><span class="math display">\[logit(zi) = \log\left(\frac{zi}{1-zi}\right) = \eta_{zi}\]</span></p>
<p>The logit-link takes values within <span class="math inline">\([0, 1]\)</span> and returns values on the real line. Thus, it allows the transition between probabilities and linear predictors.</p>
<p>According to the model, trying to fish with children not only decreases the overall number fish caught (as implied by the Poisson part of the model) but also drastically increases your change of catching no fish at all (as implied by the zero-inflation part) most likely because groups with more children are not even trying.</p>
</div>
<div id="additive-distributional-models" class="section level2">
<h2 class="hasAnchor">
<a href="#additive-distributional-models" class="anchor"></a>Additive Distributional Models</h2>
<p>In the examples so far, we did not have multilevel data and thus did not fully use the capabilities of the distributional regression framework of <strong>brms</strong>. In the example presented below, we will not only show how to deal with multilevel data in distributional models, but also how to incorporate smooth terms (i.e., splines) into the model. In many applications, we have no or only a very vague idea how the relationship between a predictor and the response looks like. A very flexible approach to tackle this problems is to use splines and let them figure out the form of the relationship. For illustration purposes, we simulate some data with the <strong>mgcv</strong> package, which is also used in <strong>brms</strong> to prepare smooth terms.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat_smooth &lt;-<span class="st"> </span>mgcv<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/mgcv/topics/gamSim">gamSim</a></span>(<span class="dt">eg =</span> <span class="dv">6</span>, <span class="dt">n =</span> <span class="dv">200</span>, <span class="dt">scale =</span> <span class="dv">2</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)
<span class="kw">head</span>(dat_smooth[, <span class="dv">1</span><span class="op">:</span><span class="dv">6</span>])</code></pre></div>
<p>The data contains the predictors <code>x0</code> to <code>x3</code> as well as the grouping factor <code>fac</code> indicating the nested structure of the data. We predict the response variable <code>y</code> using smooth terms of <code>x1</code> and <code>x2</code> and a varying intercept of <code>fac</code>. In addition, we assume the residual standard deviation <code>sigma</code> to vary by a smoothing term of <code>x0</code> and a varying intercept of <code>fac</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fit_smooth1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/brm.html">brm</a></span>(
  <span class="kw"><a href="../reference/brmsformula.html">bf</a></span>(y <span class="op">~</span><span class="st"> </span><span class="kw"><a href="../reference/s.html">s</a></span>(x1) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="../reference/s.html">s</a></span>(x2) <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span><span class="op">|</span>fac), sigma <span class="op">~</span><span class="st"> </span><span class="kw"><a href="../reference/s.html">s</a></span>(x0) <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span><span class="op">|</span>fac)),
  <span class="dt">data =</span> dat_smooth, <span class="dt">family =</span> <span class="kw">gaussian</span>(),
  <span class="dt">chains =</span> <span class="dv">2</span>, <span class="dt">control =</span> <span class="kw">list</span>(<span class="dt">adapt_delta =</span> <span class="fl">0.95</span>)
)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(fit_smooth1)
<span class="kw">plot</span>(<span class="kw"><a href="../reference/marginal_effects.html">marginal_effects</a></span>(fit_smooth1), <span class="dt">points =</span> <span class="ot">TRUE</span>, <span class="dt">ask =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p>This model is likely an overkill for the data at hand, but nicely demonstrates the ease with which one can specify complex models with <strong>brms</strong> and to fit them using <strong>Stan</strong> on the backend.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#a-simple-distributional-model">A simple distributional model</a></li>
      <li><a href="#zero-inflated-models">Zero-Inflated Models</a></li>
      <li><a href="#additive-distributional-models">Additive Distributional Models</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Paul-Christian Bürkner.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
